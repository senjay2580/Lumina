{
  "name": "èµ„æºé‡‡é›†å·¥ä½œæµ V2 (ä¼˜åŒ–ç‰ˆ)",
  "nodes": [
    {
      "parameters": {
        "rule": { "interval": [{ "field": "hours", "hoursInterval": 6 }] }
      },
      "id": "1",
      "name": "å®šæ—¶è§¦å‘",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 400]
    },
    {
      "parameters": {},
      "id": "2",
      "name": "æ‰‹åŠ¨è§¦å‘",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [0, 600]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            { "id": "1", "name": "crawl_type", "value": "tools", "type": "string" },
            { "id": "2", "name": "crawl_type_name", "value": "ğŸ› ï¸ å·¥å…·è½¯ä»¶", "type": "string" },
            { "id": "3", "name": "subreddits", "value": "SideProject,webdev,selfhosted,opensource,InternetIsBeautiful", "type": "string" },
            { "id": "4", "name": "github_queries", "value": "awesome-tools,developer-tools,productivity-tools", "type": "string" },
            { "id": "5", "name": "min_quality_score", "value": "7", "type": "number" },
            { "id": "6", "name": "min_popularity_score", "value": "7", "type": "number" },
            { "id": "7", "name": "ai_prompt", "value": "# è§’è‰²\nä½ æ˜¯èµ„æ·±å¼€å‘è€…å·¥å…·è¯„æµ‹ä¸“å®¶ï¼Œä¸“æ³¨äºå‘ç°2024-2025å¹´æœ€çƒ­é—¨ã€é«˜è´¨é‡çš„å·¥å…·ã€‚\n\n# ä»»åŠ¡\nåˆ†æå†…å®¹ï¼Œæå–ä¼˜è´¨ã€çƒ­é—¨å·¥å…·ã€‚å¿…é¡»ä½¿ç”¨web_searchéªŒè¯æœ€è¿‘æ›´æ–°ã€ç¤¾åŒºçƒ­åº¦ã€‚\n\n# ç­›é€‰æ ‡å‡†\nâœ… å¿…é¡»æ»¡è¶³è‡³å°‘3é¡¹ï¼š\n- GitHub > 1k stars æˆ– PH > 300 upvotes\n- æœ€è¿‘6ä¸ªæœˆå¢é•¿ > 30%\n- 2024å¹´åå‘å¸ƒæˆ–æœ€è¿‘3ä¸ªæœˆæœ‰æ›´æ–°\n- é›†æˆAI/LLMèƒ½åŠ›\n- ç‹¬ç‰¹è§£å†³æ–¹æ¡ˆ\n\nâŒ æ’é™¤ï¼š1å¹´æ— æ›´æ–°ã€Stars<100ã€çº¯æ¦‚å¿µã€ä»˜è´¹å¢™\n\n# è¾“å‡ºJSON\n{\"items\": [{\"name\": \"åç§°\", \"description\": \"æè¿°\", \"category\": \"åˆ†ç±»\", \"url\": \"é“¾æ¥\", \"github_url\": \"ä»“åº“\", \"platforms\": [], \"is_free\": true, \"pricing\": \"ä»·æ ¼\", \"highlights\": [], \"metrics\": {\"github_stars\": 5420, \"last_update\": \"2025-01\", \"trend\": \"ä¸Šå‡\"}, \"alternatives\": [], \"use_cases\": [], \"quality\": 8.5, \"popularity_score\": 9.0}]}\n\næ— ç¬¦åˆè¿”å› {\"items\": []}", "type": "string" },
            { "id": "8", "name": "feishu_webhook", "value": "https://open.feishu.cn/open-apis/bot/v2/hook/YOUR_WEBHOOK_ID", "type": "string" },
            { "id": "9", "name": "output_dir", "value": "/data/crawled", "type": "string" },
            { "id": "10", "name": "email_to", "value": "your-email@example.com", "type": "string" },
            { "id": "11", "name": "email_enabled", "value": "true", "type": "string" }
          ]
        }
      },
      "id": "3",
      "name": "é‡‡é›†é…ç½®",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [300, 500]
    },

    {
      "parameters": {
        "jsCode": "const subreddits = $input.first().json.subreddits.split(',');\nconst config = $input.first().json;\nreturn subreddits.map(sub => ({ subreddit: sub.trim(), ...config }));"
      },
      "id": "4",
      "name": "æ‹†åˆ†Reddit",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 200]
    },
    {
      "parameters": {
        "url": "=https://www.reddit.com/r/{{ $json.subreddit }}/hot.json?limit=30&t=week&raw_json=1",
        "options": {}
      },
      "id": "5",
      "name": "è·å–Reddit",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 200],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const posts = $input.first().json.data?.children || [];\nconst config = $input.first().json;\nconst results = [];\nfor (const child of posts) {\n  const post = child.data;\n  if (post.stickied || post.score < 20) continue;\n  const content = post.selftext || '';\n  if (content.length < 50) continue;\n  results.push({\n    title: post.title,\n    content: content.substring(0, 3000),\n    url: `https://reddit.com${post.permalink}`,\n    author: post.author,\n    source_name: `r/${post.subreddit}`,\n    source_type: 'reddit',\n    score: post.score\n  });\n}\nreturn results.slice(0, 15);"
      },
      "id": "6",
      "name": "è§£æReddit",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1200, 200]
    },
    {
      "parameters": {
        "jsCode": "const queries = $input.first().json.github_queries.split(',');\nconst config = $input.first().json;\nreturn queries.map(q => ({ query: q.trim(), ...config }));"
      },
      "id": "7",
      "name": "æ‹†åˆ†GitHubæœç´¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 400]
    },
    {
      "parameters": {
        "url": "=https://api.github.com/search/repositories?q={{ encodeURIComponent($json.query) }}+pushed:>2024-01-01&sort=stars&per_page=8",
        "options": { "headers": { "parameters": [{ "name": "Accept", "value": "application/vnd.github+json" }] } }
      },
      "id": "8",
      "name": "æœç´¢GitHub",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 400],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const repos = $input.first().json.items || [];\nconst results = [];\nfor (const repo of repos) {\n  if (repo.stargazers_count < 100) continue;\n  results.push({\n    title: repo.name,\n    description: repo.description || '',\n    url: repo.html_url,\n    author: repo.owner?.login,\n    source_name: repo.full_name,\n    source_type: 'github',\n    stars: repo.stargazers_count,\n    forks: repo.forks_count,\n    language: repo.language,\n    updated_at: repo.updated_at,\n    readme_url: `https://api.github.com/repos/${repo.full_name}/readme`\n  });\n}\nreturn results;"
      },
      "id": "9",
      "name": "è§£æGitHubä»“åº“",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1200, 400]
    },
    {
      "parameters": { "url": "={{ $json.readme_url }}", "options": {} },
      "id": "10",
      "name": "è·å–README",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1500, 400],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\nlet readme = '';\ntry {\n  if (item.content && typeof item.content === 'string') {\n    readme = Buffer.from(item.content, 'base64').toString('utf-8').substring(0, 2500);\n  }\n} catch(e) {}\nreturn [{\n  title: item.title,\n  description: item.description,\n  content: readme || item.description,\n  url: item.url,\n  author: item.author,\n  source_name: item.source_name,\n  source_type: 'github',\n  stars: item.stars,\n  forks: item.forks,\n  language: item.language,\n  updated_at: item.updated_at\n}];"
      },
      "id": "11",
      "name": "è§£ç README",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1800, 400]
    },

    {
      "parameters": {
        "url": "https://api.github.com/search/repositories?q=stars:>1000+pushed:>2024-06-01&sort=updated&per_page=10",
        "options": { "headers": { "parameters": [{ "name": "Accept", "value": "application/vnd.github+json" }] } }
      },
      "id": "27",
      "name": "è·å–GitHub Trending",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [600, 600],
      "retryOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const repos = $input.first().json.items || [];\nconst results = [];\nfor (const repo of repos.slice(0, 10)) {\n  if (repo.stargazers_count < 500) continue;\n  results.push({\n    title: repo.name,\n    description: repo.description || '',\n    url: repo.html_url,\n    author: repo.owner?.login,\n    source_name: repo.full_name,\n    source_type: 'github_trending',\n    stars: repo.stargazers_count,\n    forks: repo.forks_count,\n    language: repo.language,\n    updated_at: repo.updated_at\n  });\n}\nreturn results;"
      },
      "id": "28",
      "name": "è§£æTrending",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 600]
    },
    {
      "parameters": {
        "url": "https://api.producthunt.com/v2/api/graphql",
        "method": "POST",
        "sendHeaders": true,
        "headerParameters": { "parameters": [{ "name": "Content-Type", "value": "application/json" }, { "name": "Authorization", "value": "Bearer YOUR_PRODUCT_HUNT_API_TOKEN" }] },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\"query\": \"{ posts(first: 15, order: VOTES) { edges { node { id name tagline description votesCount commentsCount createdAt website { url } } } } }\"}"
      },
      "id": "29",
      "name": "è·å–Product Hunt",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [600, 800],
      "retryOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst posts = data?.data?.posts?.edges || [];\nconst results = [];\nfor (const edge of posts) {\n  const node = edge.node;\n  if (!node || node.votesCount < 50) continue;\n  results.push({\n    title: node.name,\n    description: node.tagline || node.description || '',\n    content: node.description || node.tagline || '',\n    url: node.website?.url || `https://www.producthunt.com/posts/${node.id}`,\n    source_name: 'Product Hunt',\n    source_type: 'producthunt',\n    votes: node.votesCount,\n    comments: node.commentsCount,\n    created_at: node.createdAt\n  });\n}\nreturn results.slice(0, 10);"
      },
      "id": "30",
      "name": "è§£æProduct Hunt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 800]
    },
    {
      "parameters": { "url": "https://hacker-news.firebaseio.com/v0/topstories.json?limitToFirst=30", "options": {} },
      "id": "31",
      "name": "è·å–HNçƒ­æ¦œID",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [600, 1000],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const ids = $input.first().json || [];\nreturn ids.slice(0, 15).map(id => ({ id }));"
      },
      "id": "32",
      "name": "æ‹†åˆ†HN ID",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 1000]
    },
    {
      "parameters": { "url": "=https://hacker-news.firebaseio.com/v0/item/{{ $json.id }}.json", "options": {} },
      "id": "33",
      "name": "è·å–HNè¯¦æƒ…",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1200, 1000],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first().json;\nif (!item || !item.title || item.score < 50) return [];\nif (item.type !== 'story' || item.dead || item.deleted) return [];\nreturn [{\n  title: item.title,\n  content: item.text || '',\n  url: item.url || `https://news.ycombinator.com/item?id=${item.id}`,\n  source_name: 'Hacker News',\n  source_type: 'hackernews',\n  score: item.score,\n  num_comments: item.descendants || 0,\n  author: item.by,\n  created_at: new Date(item.time * 1000).toISOString()\n}];"
      },
      "id": "34",
      "name": "è§£æHN",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 1000]
    },

    {
      "parameters": {
        "jsCode": "// åˆå¹¶æ‰€æœ‰æ•°æ®æº - ä½¿ç”¨ä»£ç èŠ‚ç‚¹æ›¿ä»£MergeèŠ‚ç‚¹\nconst allItems = [];\n\n// å°è¯•ä»å„ä¸ªæ•°æ®æºè·å–æ•°æ®\ntry {\n  const redditItems = $('è§£æReddit').all();\n  for (const item of redditItems) allItems.push(item.json);\n} catch(e) {}\n\ntry {\n  const githubItems = $('è§£ç README').all();\n  for (const item of githubItems) allItems.push(item.json);\n} catch(e) {}\n\ntry {\n  const trendingItems = $('è§£æTrending').all();\n  for (const item of trendingItems) allItems.push(item.json);\n} catch(e) {}\n\ntry {\n  const phItems = $('è§£æProduct Hunt').all();\n  for (const item of phItems) allItems.push(item.json);\n} catch(e) {}\n\ntry {\n  const hnItems = $('è§£æHN').all();\n  for (const item of hnItems) allItems.push(item.json);\n} catch(e) {}\n\nconsole.log(`åˆå¹¶æ•°æ®æº: å…± ${allItems.length} æ¡`);\nreturn allItems;"
      },
      "id": "12",
      "name": "åˆå¹¶æ‰€æœ‰æ•°æ®æº",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2100, 600]
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst config = $('é‡‡é›†é…ç½®').first().json;\n\n// å»é‡ï¼šåŸºäºURL\nconst seen = new Set();\nconst uniqueItems = [];\n\nfor (const itemWrapper of allItems) {\n  const item = itemWrapper.json;\n  const normalizedUrl = (item.url || '').toLowerCase().replace(/\\/+$/, '').replace(/^https?:\\/\\//, '');\n  if (!normalizedUrl || seen.has(normalizedUrl)) continue;\n  seen.add(normalizedUrl);\n  uniqueItems.push({ ...item, ...config });\n}\n\nconsole.log(`å»é‡: ${allItems.length} -> ${uniqueItems.length}`);\nreturn uniqueItems;"
      },
      "id": "35",
      "name": "å»é‡å¤„ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2400, 600]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst now = Date.now();\nconst sixMonthsAgo = now - (180 * 24 * 60 * 60 * 1000);\nconst results = [];\n\nfor (const itemWrapper of items) {\n  const item = itemWrapper.json;\n  \n  let isRecent = true;\n  if (item.updated_at) {\n    isRecent = new Date(item.updated_at).getTime() > sixMonthsAgo;\n  } else if (item.created_at) {\n    isRecent = new Date(item.created_at).getTime() > sixMonthsAgo;\n  }\n  \n  let isPopular = false;\n  if (item.source_type === 'github' || item.source_type === 'github_trending') {\n    isPopular = (item.stars || 0) >= 100;\n  } else if (item.source_type === 'reddit') {\n    isPopular = (item.score || 0) >= 20;\n  } else if (item.source_type === 'producthunt') {\n    isPopular = (item.votes || 0) >= 50;\n  } else if (item.source_type === 'hackernews') {\n    isPopular = (item.score || 0) >= 50;\n  } else {\n    isPopular = true;\n  }\n  \n  const hasContent = (item.content || item.description || '').length >= 20;\n  \n  if (isRecent && isPopular && hasContent) {\n    results.push(item);\n  }\n}\n\nconsole.log(`è´¨é‡è¿‡æ»¤: ${items.length} -> ${results.length}`);\nreturn results;"
      },
      "id": "36",
      "name": "è´¨é‡è¿‡æ»¤",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2700, 600]
    },

    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.ai_prompt }}\n\n---\næ¥æº: {{ $json.source_type }}\næ ‡é¢˜: {{ $json.title }}\n{{ $json.description || '' }}\n{{ $json.content || '' }}\n{{ $json.stars ? 'â­ Stars: ' + $json.stars : '' }}\n{{ $json.updated_at ? 'ğŸ”„ æ›´æ–°: ' + $json.updated_at : '' }}",
        "options": { "systemMessage": "ä½ æ˜¯ä¸“ä¸šèµ„æºåˆ†æåŠ©æ‰‹ã€‚ä¸¥æ ¼æŒ‰JSONæ ¼å¼è¾“å‡ºã€‚å¿…é¡»éªŒè¯å·¥å…·æ—¶æ•ˆæ€§å’Œçƒ­åº¦ã€‚" }
      },
      "id": "13",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [3000, 600]
    },
    {
      "parameters": {
        "model": "deepseek-chat",
        "options": { "baseURL": "https://api.deepseek.com", "temperature": 0.3, "maxTokens": 2000 }
      },
      "id": "14",
      "name": "DeepSeek Chat",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [3000, 820],
      "credentials": { "openAiApi": { "id": "YOUR_DEEPSEEK_CREDENTIAL_ID", "name": "DeepSeek API" } }
    },
    {
      "parameters": {
        "name": "web_search",
        "description": "æœç´¢äº’è”ç½‘éªŒè¯å·¥å…·ä¿¡æ¯ï¼šGitHub starsã€æœ€è¿‘æ›´æ–°ã€ç¤¾åŒºçƒ­åº¦ã€æ˜¯å¦ç»´æŠ¤ã€‚è¾“å…¥: å·¥å…·å+github æˆ– å·¥å…·å+reddit",
        "url": "https://api.tavily.com/search",
        "sendHeaders": true,
        "headerParameters": { "parameters": [{ "name": "Content-Type", "value": "application/json" }] },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\"api_key\": \"YOUR_TAVILY_API_KEY\", \"query\": \"{query}\", \"max_results\": 5, \"include_answer\": true, \"search_depth\": \"advanced\"}"
      },
      "id": "15",
      "name": "ç½‘ç»œæœç´¢å·¥å…·",
      "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "typeVersion": 1.1,
      "position": [3200, 820]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json;\nconst config = $('é‡‡é›†é…ç½®').first().json;\nlet parsed;\n\ntry {\n  let content = input.output || input.text || input.message?.content || '';\n  const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n  if (jsonMatch) {\n    parsed = JSON.parse(jsonMatch[0]);\n  } else {\n    return [];\n  }\n} catch(e) {\n  console.log('JSON parse error:', e);\n  return [];\n}\n\nconst items = parsed.items || [];\nconst results = [];\n\nfor (const item of items) {\n  const qualityScore = item.quality || 0;\n  const popularityScore = item.popularity_score || 0;\n  \n  if (qualityScore >= (config.min_quality_score || 7) && popularityScore >= (config.min_popularity_score || 7)) {\n    results.push({\n      name: item.name || item.title,\n      description: item.description,\n      category: item.category,\n      resource_url: item.url,\n      github_url: item.github_url,\n      platforms: item.platforms || [],\n      is_free: item.is_free !== false,\n      pricing: item.pricing || 'å…è´¹',\n      highlights: item.highlights || [],\n      metrics: item.metrics || {},\n      alternatives: item.alternatives || [],\n      use_cases: item.use_cases || [],\n      quality_score: qualityScore,\n      popularity_score: popularityScore,\n      combined_score: (qualityScore + popularityScore) / 2\n    });\n  }\n}\n\nconsole.log(`AIç­›é€‰: ${results.length} ä¸ªé«˜è´¨é‡èµ„æº`);\nreturn results;"
      },
      "id": "16",
      "name": "è§£æAIç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3300, 600]
    },

    {
      "parameters": { "aggregate": "aggregateAllItemData", "options": {} },
      "id": "17",
      "name": "æ±‡æ€»ç»“æœ",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [3600, 600]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.first().json.data || [];\nif (items.length === 0) return [{ sorted_items: [], total: 0 }];\n\nconst sorted = items.sort((a, b) => {\n  const scoreA = a.combined_score || 0;\n  const scoreB = b.combined_score || 0;\n  if (Math.abs(scoreA - scoreB) > 0.5) return scoreB - scoreA;\n  const popularityA = a.metrics?.github_stars || a.popularity_score || 0;\n  const popularityB = b.metrics?.github_stars || b.popularity_score || 0;\n  return popularityB - popularityA;\n});\n\nreturn [{ sorted_items: sorted, total: sorted.length }];"
      },
      "id": "37",
      "name": "æ™ºèƒ½æ’åº",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3900, 600]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst items = data.sorted_items || [];\nconst config = $('é‡‡é›†é…ç½®').first().json;\n\nif (items.length === 0) {\n  return [{\n    markdown: '# æœ¬æ¬¡é‡‡é›†æ— ç»“æœ\\n\\næœªå‘ç°ç¬¦åˆæ¡ä»¶çš„é«˜è´¨é‡èµ„æºã€‚',\n    items: [], total: 0, categories: [],\n    crawl_type: config.crawl_type,\n    crawl_type_name: config.crawl_type_name,\n    feishu_webhook: config.feishu_webhook,\n    output_dir: config.output_dir,\n    email_to: config.email_to,\n    email_enabled: config.email_enabled,\n    date: new Date().toLocaleDateString('zh-CN'),\n    filename: `${config.crawl_type}-${new Date().toISOString().split('T')[0]}.md`\n  }];\n}\n\nconst byCategory = {};\nfor (const item of items) {\n  const cat = item.category || 'å…¶ä»–';\n  if (!byCategory[cat]) byCategory[cat] = [];\n  byCategory[cat].push(item);\n}\n\nconst crawlType = config.crawl_type_name || 'èµ„æºé‡‡é›†';\nconst date = new Date().toLocaleDateString('zh-CN');\nconst filename = `${config.crawl_type}-${new Date().toISOString().split('T')[0]}.md`;\n\nlet md = `# ${crawlType} - ${date}\\n\\n`;\nmd += `> ğŸ¯ æœ¬æ¬¡é‡‡é›† **${items.length}** ä¸ªé«˜è´¨é‡èµ„æº\\n`;\nmd += `> ğŸ“Š æ¥æº: Reddit + GitHub + Product Hunt + Hacker News\\n\\n`;\n\nfor (const [category, catItems] of Object.entries(byCategory)) {\n  md += `## ${category}\\n\\n`;\n  for (const item of catItems) {\n    const free = item.is_free ? ' ğŸ†“' : '';\n    const badge = item.quality_score >= 9 ? ' ğŸ†' : item.quality_score >= 8 ? ' â­' : '';\n    md += `### ${item.name}${free}${badge}\\n\\n`;\n    md += `${item.description}\\n\\n`;\n    if (item.highlights?.length) md += `**äº®ç‚¹**: ${item.highlights.join(', ')}\\n\\n`;\n    if (item.resource_url) md += `ğŸ”— [å®˜ç½‘](${item.resource_url})`;\n    if (item.github_url) md += ` | [GitHub](${item.github_url})`;\n    md += `\\n\\n`;\n    if (item.metrics?.github_stars) md += `ğŸ“Š â­ ${item.metrics.github_stars} stars\\n\\n`;\n    md += `ğŸ“ˆ è´¨é‡:${item.quality_score}/10 | çƒ­åº¦:${item.popularity_score}/10\\n\\n---\\n\\n`;\n  }\n}\n\nmd += `*é‡‡é›†æ—¶é—´: ${new Date().toLocaleString('zh-CN')}*`;\n\nreturn [{\n  markdown: md, items: items, total: items.length,\n  categories: Object.keys(byCategory),\n  crawl_type: config.crawl_type,\n  crawl_type_name: crawlType,\n  feishu_webhook: config.feishu_webhook,\n  output_dir: config.output_dir,\n  email_to: config.email_to,\n  email_enabled: config.email_enabled,\n  date: date, filename: filename\n}];"
      },
      "id": "18",
      "name": "ç”Ÿæˆå¢å¼ºMD",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4200, 600]
    },

    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconsole.log('=== MDæ–‡ä»¶ ===');\nconsole.log(`æ–‡ä»¶å: ${data.filename}`);\nconsole.log(`èµ„æºæ•°: ${data.total}`);\nconsole.log(data.markdown);\nreturn [$input.first().json];"
      },
      "id": "19",
      "name": "è¾“å‡ºMD",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4500, 400]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst items = data.items || [];\n\nif (items.length === 0) {\n  return [{\n    feishu_webhook: data.feishu_webhook,\n    card: { msg_type: 'interactive', card: { header: { title: { tag: 'plain_text', content: 'é‡‡é›†å®Œæˆ - æ— æ–°èµ„æº' }, template: 'grey' }, elements: [{ tag: 'div', text: { tag: 'plain_text', content: 'æœ¬æ¬¡é‡‡é›†æœªå‘ç°ç¬¦åˆæ¡ä»¶çš„èµ„æº' } }] } }\n  }];\n}\n\nconst byCategory = {};\nfor (const item of items) {\n  const cat = item.category || 'å…¶ä»–';\n  if (!byCategory[cat]) byCategory[cat] = [];\n  byCategory[cat].push(item);\n}\n\nconst elements = [];\nelements.push({ tag: 'div', text: { tag: 'lark_md', content: `ğŸ¯ æœ¬æ¬¡é‡‡é›† **${items.length}** ä¸ªé«˜è´¨é‡èµ„æº` } });\nelements.push({ tag: 'hr' });\n\nfor (const [category, catItems] of Object.entries(byCategory)) {\n  elements.push({ tag: 'div', text: { tag: 'lark_md', content: `**ğŸ“ ${category}** (${catItems.length}ä¸ª)` } });\n  for (const item of catItems.slice(0, 5)) {\n    const free = item.is_free ? ' ğŸ†“' : '';\n    const badge = item.quality_score >= 9 ? ' ğŸ†' : item.quality_score >= 8 ? ' â­' : '';\n    let content = `**${item.name}**${free}${badge}\\n${item.description || ''}`;\n    if (item.resource_url) content += `\\n[ğŸ”— è®¿é—®](${item.resource_url})`;\n    elements.push({ tag: 'div', text: { tag: 'lark_md', content: content } });\n  }\n  if (catItems.length > 5) elements.push({ tag: 'div', text: { tag: 'lark_md', content: `_...è¿˜æœ‰ ${catItems.length - 5} ä¸ª_` } });\n  elements.push({ tag: 'hr' });\n}\n\nelements.push({ tag: 'note', elements: [{ tag: 'plain_text', content: `V2ç‰ˆ | ${new Date().toLocaleString('zh-CN')}` }] });\n\nreturn [{\n  feishu_webhook: data.feishu_webhook,\n  card: { msg_type: 'interactive', card: { header: { title: { tag: 'plain_text', content: `${data.crawl_type_name || 'èµ„æºé‡‡é›†'} - ${data.date}` }, template: 'blue' }, elements: elements } },\n  markdown: data.markdown, filename: data.filename\n}];"
      },
      "id": "20",
      "name": "æ„å»ºé£ä¹¦å¡ç‰‡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4500, 600]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.feishu_webhook }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.card) }}",
        "options": {}
      },
      "id": "21",
      "name": "å‘é€é£ä¹¦",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [4800, 600],
      "onError": "continueRegularOutput"
    },

    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst config = $('é‡‡é›†é…ç½®').first().json;\nconst mdContent = data.markdown || '';\nconst mdBase64 = Buffer.from(mdContent, 'utf-8').toString('base64');\n\nreturn [{\n  email_to: data.email_to || config.email_to,\n  email_enabled: data.email_enabled || config.email_enabled,\n  subject: `${data.crawl_type_name || 'èµ„æºé‡‡é›†'} V2 - ${data.date} [${data.total}ä¸ª]`,\n  filename: data.filename,\n  markdown: data.markdown,\n  md_base64: mdBase64,\n  total: data.total,\n  categories: data.categories,\n  crawl_type_name: data.crawl_type_name\n}];"
      },
      "id": "23",
      "name": "å‡†å¤‡é‚®ä»¶",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4500, 800]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "1", "leftValue": "={{ $json.email_enabled }}", "rightValue": "true", "operator": { "type": "string", "operation": "equals" } }]
        },
        "options": {}
      },
      "id": "24",
      "name": "æ£€æŸ¥é‚®ä»¶å¼€å…³",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [4800, 800]
    },
    {
      "parameters": {
        "fromEmail": "noreply@your-domain.com",
        "toEmail": "={{ $json.email_to }}",
        "subject": "={{ $json.subject }}",
        "emailType": "html",
        "html": "=<html><body style=\"font-family:sans-serif;max-width:600px;margin:0 auto;padding:20px;\"><h1>ğŸ¯ {{ $json.crawl_type_name }}</h1><p>æœ¬æ¬¡é‡‡é›† <strong>{{ $json.total }}</strong> ä¸ªé«˜è´¨é‡èµ„æº</p><p>åˆ†ç±»: {{ $json.categories.join(', ') }}</p><p>ğŸ“ å®Œæ•´åˆ—è¡¨è§é™„ä»¶: {{ $json.filename }}</p><p style=\"color:#999;font-size:12px;\">é‡‡é›†æ—¶é—´: {{ new Date().toLocaleString('zh-CN') }}</p></body></html>",
        "options": { "attachments": "={{ $json.filename }}", "attachmentsUi": { "attachmentsBinary": [{ "property": "data" }] } }
      },
      "id": "25",
      "name": "å‘é€é‚®ä»¶",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [5100, 750],
      "credentials": { "smtp": { "id": "YOUR_SMTP_CREDENTIAL_ID", "name": "SMTP" } }
    },
    {
      "parameters": { "jsCode": "return [{ email_skipped: true, reason: 'email_enabled is not true' }];" },
      "id": "26",
      "name": "è·³è¿‡é‚®ä»¶",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [5100, 950]
    },
    {
      "parameters": {
        "jsCode": "const feishuResult = $('å‘é€é£ä¹¦').first().json;\nconst mdData = $('ç”Ÿæˆå¢å¼ºMD').first().json;\nconst config = $('é‡‡é›†é…ç½®').first().json;\n\nlet emailSent = false;\ntry { emailSent = !!$('å‘é€é‚®ä»¶').first(); } catch(e) {}\n\nreturn [{\n  success: true, version: 'V2',\n  total: mdData.total,\n  categories: mdData.categories,\n  crawl_type: mdData.crawl_type_name,\n  filename: mdData.filename,\n  data_sources: ['Reddit', 'GitHub Search', 'GitHub Trending', 'Product Hunt', 'Hacker News'],\n  feishu_sent: feishuResult?.StatusCode === 0 || feishuResult?.code === 0,\n  email_sent: emailSent,\n  email_to: config.email_to,\n  timestamp: new Date().toISOString()\n}];"
      },
      "id": "22",
      "name": "å®ŒæˆæŠ¥å‘Š",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [5400, 600]
    }
  ],

  "connections": {
    "å®šæ—¶è§¦å‘": { "main": [[{ "node": "é‡‡é›†é…ç½®", "type": "main", "index": 0 }]] },
    "æ‰‹åŠ¨è§¦å‘": { "main": [[{ "node": "é‡‡é›†é…ç½®", "type": "main", "index": 0 }]] },
    "é‡‡é›†é…ç½®": {
      "main": [[
        { "node": "æ‹†åˆ†Reddit", "type": "main", "index": 0 },
        { "node": "æ‹†åˆ†GitHubæœç´¢", "type": "main", "index": 0 },
        { "node": "è·å–GitHub Trending", "type": "main", "index": 0 },
        { "node": "è·å–Product Hunt", "type": "main", "index": 0 },
        { "node": "è·å–HNçƒ­æ¦œID", "type": "main", "index": 0 }
      ]]
    },
    "æ‹†åˆ†Reddit": { "main": [[{ "node": "è·å–Reddit", "type": "main", "index": 0 }]] },
    "è·å–Reddit": { "main": [[{ "node": "è§£æReddit", "type": "main", "index": 0 }]] },
    "è§£æReddit": { "main": [[{ "node": "åˆå¹¶æ‰€æœ‰æ•°æ®æº", "type": "main", "index": 0 }]] },
    "æ‹†åˆ†GitHubæœç´¢": { "main": [[{ "node": "æœç´¢GitHub", "type": "main", "index": 0 }]] },
    "æœç´¢GitHub": { "main": [[{ "node": "è§£æGitHubä»“åº“", "type": "main", "index": 0 }]] },
    "è§£æGitHubä»“åº“": { "main": [[{ "node": "è·å–README", "type": "main", "index": 0 }]] },
    "è·å–README": { "main": [[{ "node": "è§£ç README", "type": "main", "index": 0 }]] },
    "è§£ç README": { "main": [[{ "node": "åˆå¹¶æ‰€æœ‰æ•°æ®æº", "type": "main", "index": 0 }]] },
    "è·å–GitHub Trending": { "main": [[{ "node": "è§£æTrending", "type": "main", "index": 0 }]] },
    "è§£æTrending": { "main": [[{ "node": "åˆå¹¶æ‰€æœ‰æ•°æ®æº", "type": "main", "index": 0 }]] },
    "è·å–Product Hunt": { "main": [[{ "node": "è§£æProduct Hunt", "type": "main", "index": 0 }]] },
    "è§£æProduct Hunt": { "main": [[{ "node": "åˆå¹¶æ‰€æœ‰æ•°æ®æº", "type": "main", "index": 0 }]] },
    "è·å–HNçƒ­æ¦œID": { "main": [[{ "node": "æ‹†åˆ†HN ID", "type": "main", "index": 0 }]] },
    "æ‹†åˆ†HN ID": { "main": [[{ "node": "è·å–HNè¯¦æƒ…", "type": "main", "index": 0 }]] },
    "è·å–HNè¯¦æƒ…": { "main": [[{ "node": "è§£æHN", "type": "main", "index": 0 }]] },
    "è§£æHN": { "main": [[{ "node": "åˆå¹¶æ‰€æœ‰æ•°æ®æº", "type": "main", "index": 0 }]] },
    "åˆå¹¶æ‰€æœ‰æ•°æ®æº": { "main": [[{ "node": "å»é‡å¤„ç†", "type": "main", "index": 0 }]] },
    "å»é‡å¤„ç†": { "main": [[{ "node": "è´¨é‡è¿‡æ»¤", "type": "main", "index": 0 }]] },
    "è´¨é‡è¿‡æ»¤": { "main": [[{ "node": "AI Agent", "type": "main", "index": 0 }]] },
    "DeepSeek Chat": { "ai_languageModel": [[{ "node": "AI Agent", "type": "ai_languageModel", "index": 0 }]] },
    "ç½‘ç»œæœç´¢å·¥å…·": { "ai_tool": [[{ "node": "AI Agent", "type": "ai_tool", "index": 0 }]] },
    "AI Agent": { "main": [[{ "node": "è§£æAIç»“æœ", "type": "main", "index": 0 }]] },
    "è§£æAIç»“æœ": { "main": [[{ "node": "æ±‡æ€»ç»“æœ", "type": "main", "index": 0 }]] },
    "æ±‡æ€»ç»“æœ": { "main": [[{ "node": "æ™ºèƒ½æ’åº", "type": "main", "index": 0 }]] },
    "æ™ºèƒ½æ’åº": { "main": [[{ "node": "ç”Ÿæˆå¢å¼ºMD", "type": "main", "index": 0 }]] },
    "ç”Ÿæˆå¢å¼ºMD": {
      "main": [[
        { "node": "è¾“å‡ºMD", "type": "main", "index": 0 },
        { "node": "æ„å»ºé£ä¹¦å¡ç‰‡", "type": "main", "index": 0 },
        { "node": "å‡†å¤‡é‚®ä»¶", "type": "main", "index": 0 }
      ]]
    },
    "è¾“å‡ºMD": { "main": [[{ "node": "å®ŒæˆæŠ¥å‘Š", "type": "main", "index": 0 }]] },
    "æ„å»ºé£ä¹¦å¡ç‰‡": { "main": [[{ "node": "å‘é€é£ä¹¦", "type": "main", "index": 0 }]] },
    "å‘é€é£ä¹¦": { "main": [[{ "node": "å®ŒæˆæŠ¥å‘Š", "type": "main", "index": 0 }]] },
    "å‡†å¤‡é‚®ä»¶": { "main": [[{ "node": "æ£€æŸ¥é‚®ä»¶å¼€å…³", "type": "main", "index": 0 }]] },
    "æ£€æŸ¥é‚®ä»¶å¼€å…³": {
      "main": [
        [{ "node": "å‘é€é‚®ä»¶", "type": "main", "index": 0 }],
        [{ "node": "è·³è¿‡é‚®ä»¶", "type": "main", "index": 0 }]
      ]
    },
    "å‘é€é‚®ä»¶": { "main": [[{ "node": "å®ŒæˆæŠ¥å‘Š", "type": "main", "index": 0 }]] },
    "è·³è¿‡é‚®ä»¶": { "main": [[{ "node": "å®ŒæˆæŠ¥å‘Š", "type": "main", "index": 0 }]] }
  },
  "settings": { "executionOrder": "v1" }
}